<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">

</head>

<body>
    <div class="wrapper">
        <h1>ลงทะเบียน</h1>

        <form id="registerForm" class="mt-2">
            <div class="form-group">
                <label for="first" class="visually-hidden">ชื่อจริง</label>
                <input id="first" type="text" class="form-control" placeholder="ชื่อจริง" required>
            </div>
            <div class="form-group">
                <label for="last" class="visually-hidden">นามสกุล</label>
                <input id="last" type="text" class="form-control" placeholder="นามสกุล" required>
            </div>
            <div class="form-group">
                <label for="email" class="visually-hidden">อีเมล</label>
                <input id="email" type="email" class="form-control" placeholder="อีเมล" required>
            </div>
            <div class="form-group">
                <label for="password" class="visually-hidden">รหัสผ่าน</label>
                <input id="password" type="password" class="form-control" placeholder="รหัสผ่าน" minlength="6" required>
            </div>
            <div class="form-group">
                <label for="confirm" class="visually-hidden">ยืนยันรหัสผ่าน</label>
                <input id="confirm" type="password" class="form-control" placeholder="ยืนยันรหัสผ่าน" minlength="6"
                    required>
            </div>

            <div id="regAlert" class="small text-danger mb-2" style="display:none;"></div>

            <button id="submitBtn" class="btn btn-primary w-100 mt-1" type="submit">ลงทะเบียน</button>
        </form>

        <p class="helper">มีบัญชีอยู่แล้ว? <a href="/login">ลงชื่อเข้าใช้ที่นี่</a></p>
    </div>

<script>
    const $ = s => document.querySelector(s);
    const showErr = (m) => { const a = $('#regAlert'); a.textContent = m; a.style.display='block'; };
    const hideErr = () => { $('#regAlert').style.display='none'; };

    const form = $('#registerForm');
    const btn  = $('#submitBtn');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideErr();

      const first = $('#first').value.trim();
      const last  = $('#last').value.trim();
      const email = $('#email').value.trim();
      const pass  = $('#password').value;
      const cpass = $('#confirm').value;

      if (!first || !last || !email || !pass || !cpass) return showErr('กรอกข้อมูลให้ครบก่อนน้า');
      if (pass !== cpass) return showErr('รหัสผ่านไม่ตรงกัน');
      if (pass.length < 6) return showErr('รหัสผ่านอย่างน้อย 6 ตัวอักษร');

      btn.disabled = true; btn.textContent = 'กำลังสมัคร...';

      try {
        // สมัครผ่าน /api/auth/register
        const res = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({
            first_name: first,
            last_name : last,
            email,
            password  : pass
          }),
        });

        const data = await res.json().catch(() => null);
        if (!res.ok) {
          const msg = (data && (data.message || data.error)) || `สมัครไม่สำเร็จ (HTTP ${res.status})`;
          throw new Error(msg);
        }

        alert('สมัครสมาชิกสำเร็จ!');
        location.href = '/login';
      } catch (err) {
        showErr(err.message || 'เกิดข้อผิดพลาด');
      } finally {
        btn.disabled = false; btn.textContent = 'ลงทะเบียน';
      }
    });
  </script>    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
        integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
        crossorigin="anonymous"></script>
</body>

</html>